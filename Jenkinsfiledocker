pipeline {
   agent any
   parameters {
         string(name: 'registryip', defaultValue: 'registry.progressoft.com', description: 'Staging Server')
         string(name: 'username', defaultValue: 'admin', description: 'username')
         string(name: 'password', defaultValue: 'admin123', description: 'password')
   }
   stages{
     stage('build'){
       steps{
         sh 'mvn clean package'
        }
     }
     
     stage('Docker'){
       steps{  
            // repository = "${registryIp}/tomcatwebapp:${env.BUILD_ID}"
            sh "docker login -u ${username} -p ${password} ${registryip}"
            sh "docker build . -t tomcatwebapp:${env.BUILD_ID}"
            sh "docker tag  tomcatwebapp:${env.BUILD_ID} ${registryIp}/tomcatwebapp:${env.BUILD_ID}"
            sh "docker push ${registryIp}/tomcatwebapp:${env.BUILD_ID}"
            sh "docker rmi tomcatwebapp:${env.BUILD_ID}"
            sh "docker rmi ${registryIp}/tomcatwebapp:${env.BUILD_ID}"
         
         
        }

      }
     }
  
  

}
